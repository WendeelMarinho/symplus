.PHONY: help setup-web install generate watch run-web run run-ios test clean build-android build-ios build-web share-ngrok share-cloudflare

help:
	@echo "Symplus Finance - Flutter App"
	@echo ""
	@echo "Comandos dispon√≠veis:"
	@echo "  make setup-web     - Habilita suporte web (execute primeiro!)"
	@echo "  make install       - Instala depend√™ncias"
	@echo "  make generate      - Gera c√≥digo (freezed, json_serializable)"
	@echo "  make run-web       - Executa o app no Chrome (web)"
	@echo "  make run-web-share - Executa app preparado para compartilhar (ngrok/cloudflare)"
	@echo "  make run           - Executa o app (Android)"
	@echo "  make run-ios       - Executa o app (iOS)"
	@echo "  make test          - Executa testes"
	@echo "  make clean         - Limpa build files"
	@echo "  make build-android - Build APK/AAB para Android"
	@echo "  make build-ios     - Build para iOS"
	@echo "  make build-web     - Build web para deploy"
	@echo "  make share-ngrok   - Compartilha app via ngrok (requer ngrok instalado)"
	@echo "  make share-cloudflare - Compartilha app via Cloudflare Tunnel"

setup-web:
	@echo "Habilitando suporte web..."
	flutter create . --platforms=web
	@echo "‚úÖ Suporte web habilitado!"

install:
	@echo "Instalando depend√™ncias..."
	flutter pub get

generate:
	@echo "Gerando c√≥digo..."
	flutter pub run build_runner build --delete-conflicting-outputs

watch:
	@echo "Gerando c√≥digo (watch mode)..."
	flutter pub run build_runner watch --delete-conflicting-outputs

run-web:
	@echo "Executando app no Chrome (web)..."
	flutter run -d chrome

run-web-share:
	@echo "Executando app no Chrome (web) - preparado para compartilhar..."
	@echo "‚ö†Ô∏è  Use este comando quando for compartilhar via ngrok/cloudflare"
	@flutter run -d chrome --web-hostname=0.0.0.0 --web-port=8080

run:
	@echo "Executando app (Android)..."
	flutter run

run-ios:
	@echo "Executando app (iOS)..."
	flutter run -d ios

test:
	@echo "Executando testes..."
	flutter test

clean:
	@echo "Limpando build files..."
	flutter clean
	flutter pub get

build-android:
	@echo "Building Android APK..."
	@echo "‚ö†Ô∏è  Para dispositivo f√≠sico, configure o IP do backend:"
	@echo "   flutter build apk --release --dart-define=API_BASE_URL=http://SEU_IP:8000"
	flutter build apk --release

build-android-device:
	@echo "Building Android APK para dispositivo f√≠sico..."
	@echo "‚ö†Ô∏è  Configure SEU_IP com o IP da sua m√°quina na rede local"
	@read -p "Digite o IP do backend (ex: 192.168.1.100): " IP; \
	flutter build apk --release --dart-define=API_BASE_URL=http://$$IP:8000

build-ios:
	@echo "Building iOS..."
	flutter build ios --release

build-web:
	@echo "Building web app for deployment..."
	flutter build web --release
	@echo "‚úÖ Build completo! Arquivos em: build/web"
	@echo "üì¶ Pronto para deploy em Vercel, Netlify ou Firebase Hosting"

share-ngrok:
	@echo "üåê Compartilhando app via ngrok..."
	@echo "‚ö†Ô∏è  Certifique-se que:"
	@echo "   1. O app est√° rodando em outro terminal: make run-web-share"
	@echo "   2. O backend est√° acess√≠vel (se usar API)"
	@echo "   3. O ngrok est√° instalado e configurado"
	@echo ""
	@echo "üí° Se receber erro 502, verifique se usou: make run-web-share"
	@echo ""
	@read -p "Pressione Enter para continuar..." dummy
	ngrok http 8080

share-cloudflare:
	@echo "üåê Compartilhando app via Cloudflare Tunnel..."
	@echo "‚ö†Ô∏è  Certifique-se que:"
	@echo "   1. O app est√° rodando em outro terminal: make run-web-share"
	@echo "   2. O backend est√° acess√≠vel (se usar API)"
	@echo "   3. O cloudflared est√° instalado"
	@echo ""
	@echo "üí° Se receber erro 502, verifique se usou: make run-web-share"
	@echo ""
	@read -p "Pressione Enter para continuar..." dummy
	cloudflared tunnel --url http://localhost:8080

